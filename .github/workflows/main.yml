name: unit_test
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:
concurrency: 
  group: ${{github.ref}}
  cancel-in-progress: true 

jobs:
  test: 
    runs-on: ubuntu-latest
    steps:
      - name: chechkout repo 
        uses: actions/checkout@v4 
        with: 
          fetch-depth: 0
      - name: setup python 
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: install dependency
        run: |
          pip install --upgrade pip 
          pip install -r src/requirements.txt
      - name: run code linting 
        run: flake8 . --max-line-length=120 --statistics 
      - name: run test 
        run: pytest src/* -v --maxfail=1 --disable-warnings --cov=. --cov-report=term-missing
      - name: run scan of code 
        run: bandit -r . -ll -s B101,B102,B103,B104,B105
      - name: scan dependency 
        run: safety check --full-report || true 
  